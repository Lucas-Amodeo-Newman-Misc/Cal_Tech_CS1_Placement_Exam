import sys
from random import randrange

class Rule(): # Represents the rule of the automaton

    # Takes a 4-tuple (zero, one, two, three) corresponding to the rule spec.    
    def __init__(self, tupl):
         self._tupl = tupl

    # Applies the rule spec to an inputted sum to produce a cell value.
    def cell(self, value):
         return self._tupl[value]

class Line(): # Represents a single line of cells

    def __init__(self):
        self._contents = []

    # adds a cell to the line
    def add(self, value):
        self._contents.append(value)

    # prints the line as a string
    def display(self):
        print("".join(list(map(str, self._contents))))

    # creates a SumLine
    def export_sumline(self):
        return SumLine(self._contents)

    def random(self, width):
        self._contents = [randrange(0, 2) for i in range(width)]

class SumLine(): # Represents a single line of sums, suitable for interpretation by the rule.

    # creates the list of sums for each location in the line
    def __init__(self, contents):
        full_contents = [0] + contents + [0] # augementation to avoid problems at the margin
        trios = [[full_contents[j] for j in range(i, i+3)] for i in range(len(full_contents)-2)] # creates a list of cell triplets
        self._values = [sum(i) for i in trios] # sums each cell triplet to create the list of sums

    # uses a rule to produce a new line
    def export_line(self, rule):
        new_line = Line()
        for i in self._values:
            new_line.add(rule.cell(i)) 
        return new_line

class Automaton():

    def __init__(self, args):
        iargs = list(map(int, args[1:]))
        self._width = iargs[0]
        self._gens = iargs[1]
        self._rule = Rule(iargs[2:])
        self._lines = []
        
    def run(self):
        self._lines = []
        first_line = Line()
        first_line.random(self._width)
        first_line.display()
        self._lines.append(first_line)
        for i in range(self._gens-1):
            new_sumline = self._lines[-1].export_sumline()
            new_line = new_sumline.export_line(self._rule)
            new_line.display()
            self._lines.append(new_line)

Automaton(sys.argv).run()
            
        
        

        

        
        
        
        
        
        
        

        

    
